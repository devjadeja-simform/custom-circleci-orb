description: |
  This job installs the dependencies packages for the project.
docker:
  - image: cimg/node:<< parameters.node_version >>

parameters:
  - node_version:
    type: string
    default: "18"
    description: Select the version of cimg/node
  - prj_path:
    type: string
    default: ./
    description: Project path where package.json lies.

steps:
  - checkout
  - restore_cache:
      key: dependency-cache-{{ checksum "yarn.lock" }}-dependency-cache-{{ checksum "package.json" }}
  - run:
      name: Install
      command: |
        cd << parameters.prj_path >>;
        if [[ ! -d node_modules ]]; then yarn install; fi
  - save_cache:
      key: dependency-cache-{{ checksum "yarn.lock" }}-dependency-cache-{{ checksum "package.json" }}
      paths:
        - node_modules
  - persist_to_workspace:
      root: ~/project
      paths:
        - node_modules
