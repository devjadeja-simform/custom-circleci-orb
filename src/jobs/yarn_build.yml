description: |
  This job creates a distributable build of the project from the source code.

docker:
  - image: cimg/node:<< parameters.node_version >>

parameters:
  node_version:
    type: string
    default: "18.18"
    description: |
      Select the version of Node.js to use. Uses CircleCI's highly cached convenience images built for CI.
      Any available tag from this list can be used: https://hub.docker.com/r/cimg/node/tags
  prj_path:
    type: string
    default: "./"
    description: Project path where package.json lies.

steps:
  - attach_workspace:
      at: ~/project
  - run:
      name: Build apps
      command: |
        cd "$prj_path"
        yarn build
  - run: 
      name: Package
      command: |
        if [[ -d "dist/" ]]; then zip -r ~/project/dist.zip dist/ ; fi
        if [[ -d "build/" ]]; then zip -r ~/project/build.zip dist/ ; fi
  - persist_to_workspace:
      root: ~/project/<< parameters.prj_path >>/
      paths:
        - dist/*
        - build/*
  - store_artifacts:
      path: ~/project
      destination: 
        - dist.zip
        - build.zip